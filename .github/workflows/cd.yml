name: CD
on: [push]
jobs:
    test:
        runs-on: ubuntu-latest
        steps:
        - uses: actions/checkout@v3
        - name: Run tests
          run: echo "Running tests..."
    
    deploy:
        needs: test
        if: github.ref == 'refs/heads/main'
        runs-on: ubuntu-latest
        steps:
        - uses: actions/checkout@v3
        - name: Deploy to VPS
          uses: SamKirkland/FTP-Deploy-Action@v4.3.6
          with:
            server: ftpiut21.u-bourgogne.fr/file
            host: ${{ secrets.VPS_HOST }}
            username: ${{ secrets.VPS_USER }}
            port: ${{ secrets.VPS_PORT }}
            script: |
                cd /var/www/myapp
                git pull origin main
                composer install --no-dev
                php bin/console cache:clear